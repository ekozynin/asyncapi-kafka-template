asyncapi: '2.1.0'
info:
  title: Confluent Kafka Example
  version: '0.0.1'
  description: |
    An example of Kafka topology using AsyncApi

servers:
  local:
    url: localhost:9092
    protocol: kafka
    protocolVersion: 2.6.0
    description: local kafka cluster for development
    x-schema-registry-url: http://localhost:8081

channels:
  example-channel:
    x-messageCompatibility: 'FULL' # https://docs.confluent.io/platform/current/schema-registry/avro.html#schema-evolution-and-compatibility
    x-message:
      $ref: '#/components/messages/OrganisationFact'
    bindings:
      kafka:
        x-partitions: 9
        x-replicas: 1
        x-configs:
          cleanup.policy: compact
          delete.retention.ms: 0
          confluent.value.schema.validation: 'true'

components:
  messages:
    ExampleMessage:
      title: Example Message
      summary: This message has a reference to another schema
      schemaFormat: application/vnd.apache.avro;version=1.9.0
      payload:
        $ref: '../schemas/ExampleMessage.avsc'
      x-schemaReferences:
        - another.AnotherMessage

    AnotherMessage:
      schemaFormat: application/vnd.apache.avro+yaml;version=1.9.0
      payload:
        $ref: './schema/AnotherMessage.avsc'
